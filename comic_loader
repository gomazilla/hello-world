# 卡提諾漫畫下載-手動填入網址，頁數，輸出檔名
import requests
from bs4 import BeautifulSoup
import shutil, time, zipfile, os, ctypes, sys, gzip

ftype = ["jpg","png","gif"]
temp_file_path = r"E:Download\Comic"
comic_url = "http://m.comic.ck101.com/vols/3960100/"
total_pages = 96
goal_file = r"E:Download\OutputData\INU30.zip"

#下載圖檔

for page in range(0, total_pages):
    pageurl = comic_url + str(page + 1)
    time.sleep(1)
    res = requests.get(pageurl)
    soup = BeautifulSoup(res.text, "html5lib")
    
    for img in soup.select('#comicimg'):
        address = img.find('img')['src']
        ttl = img.find('img')['alt']
        print "\rDownload Page : ", str(page + 1),
        sys.stdout.flush()
        
        fname = str(page + 1).zfill(3) + ".jpg"
        pic_img = requests.get(address)
        try:
            g = gzip.open(pic_img.content, 'rb')
            image_data = g.read()
        except:
            image_data = pic_img.content
        
        f = open("E:Download\Comic\\" + fname, 'wb')
        f.write(image_data)
        f.close()
        shutil.copyfileobj(pic_img.raw, f)
        del pic_img
        
#製作壓縮檔

zf = zipfile.ZipFile(goal_file, mode='w')
os.chdir(temp_file_path)

for root, folders, files in os.walk(".\\"):
    for sfile in files:
        aFile = os.path.join(root, sfile)

        zf.write(aFile)
        os.remove(aFile)
zf.close()

#報完成

MessageBox = ctypes.windll.user32.MessageBoxW
MessageBox(0, u"Download Completed", u"Download Completed", 0|0x00000000L)
